const fs = require('fs');
const base = `${process.cwd()}/node_modules`;
const stubs = ['crypto', 'dns', 'net', 'path'];

stubs.forEach((stub) => {
	if (!fs.existsSync(base)) {
		fs.mkdirSync(base);
	}

	if (!fs.existsSync(`${base}/${stub}`)) {
		fs.mkdirSync(`${base}/${stub}`);
	}
	
	fs.createReadStream(`${process.cwd()}/stubs/${stub}/index.js`).pipe(fs.createWriteStream(`${base}/${stub}/index.js`));
	fs.createReadStream(`${process.cwd()}/stubs/${stub}/package`).pipe(fs.createWriteStream(`${base}/${stub}/package.json`));

	let packageFile = require(`${process.cwd()}/package.json`);

	packageFile.dependencies = {
		buffer: packageFile.dependencies.buffer,
		crypto: '1.0.0',
		dns: '1.0.0',
		joi: packageFile.dependencies.joi,
		net: '1.0.0',
		path: '1.0.0'
	};

	fs.writeFileSync(`${process.cwd()}/package.json`, JSON.stringify(packageFile, null, 2));
});

